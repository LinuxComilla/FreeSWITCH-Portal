
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Bootstrap, from Twitter</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">

	<!-- Le styles -->
	<link href="assets/bootstrap/css/bootstrap.css" rel="stylesheet">
	<style>
	body {
		padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
	}
	</style>
	<link href="assets/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

	<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
	<script src="assets/js/html5shiv.js"></script>
	<![endif]-->

	<!-- Fav and touch icons -->
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png">
	<link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png">
	<link rel="shortcut icon" href="assets/ico/favicon.png">
</head>

<body>

	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="brand" href="#">FreeSWITCH</a>
				<div class="pull-right" id='ws-status' style="padding-top:5px"></div>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="active"><a href="#">Home</a></li>
						<li><a id="menu-calls" href="#calls">Calls</a></li>
						<li><a id="menu-channels" href="#channels">Channels</a></li>
						<li><a href="#show">Show</a></li>
						<li><a href="#about">About</a></li>
					</ul>
				</div><!--/.nav-collapse -->
			</div>
		</div>
	</div>

	<div class="container" id="container">
		<div id="calls" style="display:none"></div>
		<div id="channels" style="display:none"></div>
	</div> <!-- /container -->

	<div id="aa"></div>
	<script type="text/x-handlebars" data-template-name="index">
		<h1>Welcome to FreeSWITCH Portal</h1>
		Welcome
	</script>

	<script type="text/x-handlebars" data-template-name="showApplications">
		<h1>Applications</h1>
		<div>
			<table class="table">
			<tr>
				<th>Name</th>
				<th>Description</th>
				<th>Syntax</th>
				<th>iKey</th>
			</tr>
			{{#each App.applicationsController.content}}
			<tr>
				<td>{{ name }}</td>
				<td>{{ description }}</td>
				<td>{{ syntax }}</td>
				<td>{{ ikey }}</td>
			</tr>
			{{/each}}
			</table>
		</div>
	</script>

	<script type="text/x-handlebars" data-template-name="showEndpoints">
		<h1>Endpoints</h1>
		<div>
			<table class="table">
			<tr>
				<th>Type</th>
				<th>Name</th>
				<th>iKey</th>
			</tr>
			{{#each App.showEndpointsController.content}}
			<tr>
				<td>{{ type }}</td>
				<td>{{ name }}</td>
				<td>{{ ikey }}</td>
			</tr>
			{{/each}}
			</table>
		</div>
	</script>

	<script type="text/x-handlebars" data-template-name="showCodecs">
		<h1>Codecs</h1>
		<div>
			<table class="table">
			<tr>
				<th>Type</th>
				<th>Name</th>
				<th>iKey</th>
			</tr>
			{{#each App.showCodecsController.content}}
			<tr>
				<td>{{ type }}</td>
				<td>{{ name }}</td>
				<td>{{ ikey }}</td>
			</tr>
			{{/each}}
			</table>
		</div>
	</script>

	<script type="text/x-handlebars" data-template-name="showFiles">
		Unimplemented
	</script>

	<script type="text/x-handlebars" data-template-name="showAPIs">
		Unimplemented
	</script>

	<script type="text/x-handlebars" data-template-name="show">
		<h1>Show</h1>
		{{#linkTo "showApplications"}} Applications {{/linkTo}} |
		{{#linkTo "showEndpoints"}} Endpoints {{/linkTo}} |
		{{#linkTo "showCodecs"}} Codecs {{/linkTo}} |
		{{#linkTo "showFiles"}} Files {{/linkTo}} |
		{{#linkTo "showAPIs"}} APIs {{/linkTo}}
	</script>

	<script type="text/x-handlebars" data-template-name="about">
		<h1>About</h1>
		About this ...
	</script>

	<script type="text/x-handlebars" data-template-name="calls">
	<h1>Calls</h1>

	<div>
		<table class="table">
		<tr>
			<th>Call UUID</th>
			<th>CID</th>
			<th>Dest</th>
			<th>Call State</th>
			<th>Direction / Created</th>
		</tr>
		{{#each App.callsController.content}}
		<tr>
			<td>{{uuid}} <br>{{ b_uuid }}</td>
			<td>{{ cid_num }}<br>{{ b_cid_num }}</td>
			<td>{{ dest }}<br>{{ b_dest }}</td>
			<td>{{ callstate }}<br>{{ b_callstate }}</td>
			<td>{{ direction }} / {{ b_direction }}<br>
			<a href='#' {{action "dump" uuid target="App.callsController"}}>{{created}}</a>
			</td>
		</tr>
		{{/each}}
		</table>
	</div>

	</script>

	<script type="text/x-handlebars" data-template-name="channels">

	<h1>Channels</h1>

	<div>

		<table class="table">
		<tr>
			<th>Call UUID</th>
			<th>CID</th>
			<th>Dest</th>
			<th>Call State</th>
			<th>Direction / Created</th>
		</tr>
		{{#each App.channelsController.content}}
		<tr>
			<td>{{uuid}}</td>
			<td>{{ cid_num }}</td>
			<td>{{ dest }}<br></td>
			<td>{{ callstate }}</td>
			<td>{{ direction }}<br>
			<a href='#' {{action "dump" uuid target="App.channelsController"}}>{{created}}</a>
			</td>
		</tr>
		{{/each}}
		</table>

	</div>

	</script>
<!-- Le javascript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="assets/js/jquery-1.9.1.min.js"></script>
<script src="assets/js/handlebars.js"></script>
<script src="assets/js/ember-1.0.0-rc.1.js"></script>
<script src="assets/js/ember-data.js"></script>
<script src="assets/js/fsportal.js"></script>
<!--
<script src="assets/js/bootstrap-transition.js"></script>
<script src="assets/js/bootstrap-alert.js"></script>
<script src="assets/js/bootstrap-modal.js"></script>
<script src="assets/js/bootstrap-dropdown.js"></script>
<script src="assets/js/bootstrap-scrollspy.js"></script>
<script src="assets/js/bootstrap-tab.js"></script>
<script src="assets/js/bootstrap-tooltip.js"></script>
<script src="assets/js/bootstrap-popover.js"></script>
<script src="assets/js/bootstrap-button.js"></script>
<script src="assets/js/bootstrap-collapse.js"></script>
<script src="assets/js/bootstrap-carousel.js"></script>
<script src="assets/js/bootstrap-typeahead.js"></script>
-->
<script type="text/javascript">

	// $("#menu-channels").click(function(e){
	// 	e.preventDefault();
	// 	App.channelsController.load();
	// 	$('#calls').hide();
	// 	$('#channels').show();
	// });

	// $("#menu-calls").click(function(e){
	// 	e.preventDefault();
	// 	App.callsController.load();
	// 	$('#channels').hide();
	// 	$('#calls').show();
	// });

	// var callsView = Ember.View.create({
	// templateName: 'calls',
	// name: "callsView"
	// });

	// // $('#container').html('');
	// callsView.appendTo('#calls');

	// var channelsView = Ember.View.create({
	// 	templateName: 'channels',
	// 	name: "channelsView"
	// });
	// channelsView.appendTo('#channels');

	function dump_call(uuid) {
		obj = App.callsController.content.findProperty("uuid", uuid);
		console.log(obj);
	}

	</script>

	<script type="text/javascript">

	var socket = new WebSocket("ws://localhost:8086/socket", "websocket");

	try {
		socket.onopen = function() {
			$('#ws-status').html('Socket Connected').css("color", "green");
			// socket.send("event json all");
			socket.send("event json CHANNEL_CREATE");
			socket.send("event json CHANNEL_HANGUP_COMPLETE");
			socket.send("event json CHANNEL_CALLSTATE");
		}

		socket.onmessage =function(msg) {
			// console.log(msg.data);
			var data = JSON.parse(msg.data);
			console.log(data["Event-Name"]);

			if (data["Event-Name"] == "CHANNEL_CREATE") {
				var channel = {
					uuid: data["Unique-ID"],
					cid_num: data["Caller-Caller-ID-Number"],
					dest: data["Caller-Destination-Number"],
					callstate: data["Channel-Call-State"],
					direction: data["Call-Direction"]
				}
				App.channelsController.pushObject(App.Channel.create(channel));
			} else if (data["Event-Name"] == "CHANNEL_HANGUP_COMPLETE") {
				App.channelsController.delete(data["Unique-ID"]);
			} else if (data["Event-Name"] == "CHANNEL_CALLSTATE") {
				var obj = App.channelsController.content.findProperty("uuid", data["Unique-ID"]);
				if (obj) {
					obj.set("callstate", data["Channel-Call-State"]);
				}

			}
		}

		socket.onclose = function(){
			$('#ws-status').html('Socket Disconnected!').css("color", "red");
		}
	} catch(exception) {
		alert('Error' + exception);
	}

	</script>
</body>
</html>
